# Cal.com Webhook: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ server —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

## üéØ –¶–µ–ª—å
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å apps/website –ø–æ–¥ –≤–µ–±—Ö—É–∫ Cal.com —Å server —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º GET-—Ö—ç–Ω–¥–ª–µ—Ä–æ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Astro
- ‚úÖ **@astrojs/node —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** - –¥–ª—è server —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- ‚úÖ **output: 'hybrid'** - –≤–∫–ª—é—á–µ–Ω on-demand —Ä–µ–Ω–¥–µ—Ä –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **adapter –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - —Ç–æ–ª—å–∫–æ –¥–ª—è production build
- ‚úÖ **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã** - alias, allowedHosts, vite –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π GET-—Ö—ç–Ω–¥–ª–µ—Ä –≤ webhook.ts
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ CAL_DEBUG** - GET –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ CAL_DEBUG=1
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ù–ï –æ—Ç–¥–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç, —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å
- ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - mode, hasSecret, tunnel origin
- ‚úÖ **404 –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º DEBUG** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 3. POST-–ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ **RAW body + HMAC + timingSafeEqual** - –≤—Å–µ –∫–∞–∫ –±—ã–ª–æ
- ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - fire-and-forget –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
apps/website/
‚îú‚îÄ‚îÄ astro.config.mjs                              # –î–æ–±–∞–≤–ª–µ–Ω output: 'hybrid'
‚îú‚îÄ‚îÄ src/pages/api/cal/webhook.ts                  # –î–æ–±–∞–≤–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π GET
‚îî‚îÄ‚îÄ package.json                                  # @astrojs/node —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- Astro v4.16.19 ready in 772ms
- Local: http://localhost:4321/
- Network: –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö

### ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç:
- `/en/bookme` - ‚úÖ 200 (24ms, 26ms, 6ms, 5ms, 8ms)
- `/ru/bookme` - ‚úÖ 200 (5ms)

### ‚úÖ –í–µ–±—Ö—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- POST –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (500 –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è CAL_WEBHOOK_SECRET)
- GET –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404 (–±–µ–∑ CAL_DEBUG=1)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è:
- output: 'hybrid' –≤–∫–ª—é—á–µ–Ω
- POST –∑–∞–ø—Ä–æ—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
- Headers –¥–æ—Å—Ç—É–ø–Ω—ã –≤ API routes

## üîß –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
npm run dev
# –∏–ª–∏
npx astro dev
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
http://localhost:4321/en/bookme
http://localhost:4321/ru/bookme
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±—Ö—É–∫–∞
```bash
# GET –∑–∞–ø—Ä–æ—Å (–±–µ–∑ CAL_DEBUG=1)
curl http://localhost:4321/api/cal/webhook
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 404

# POST –∑–∞–ø—Ä–æ—Å (–±–µ–∑ CAL_WEBHOOK_SECRET)
curl -X POST http://localhost:4321/api/cal/webhook
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 500 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ missing CAL_WEBHOOK_SECRET
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –æ—Ç–ª–∞–¥–∫–æ–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
CAL_DEBUG=1
CAL_WEBHOOK_SECRET=test-secret

# GET –∑–∞–ø—Ä–æ—Å
curl http://localhost:4321/api/cal/webhook
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Server —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- **output: 'hybrid'** - –ø–æ–∑–≤–æ–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –≤ API routes
- **@astrojs/node** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è production build
- **adapter –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - –Ω–µ –º–µ—à–∞–µ—Ç dev —Ä–µ–∂–∏–º—É

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π GET-—Ö—ç–Ω–¥–ª–µ—Ä
- **–¢–æ–ª—å–∫–æ –ø—Ä–∏ CAL_DEBUG=1** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ù–µ –æ—Ç–¥–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç** - —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å hasSecret
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - mode, tunnel origin
- **404 –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º DEBUG** - —Å–∫—Ä—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ endpoint

### POST-–ª–æ–≥–∏–∫–∞
- **–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –≤—Å–µ –∫–∞–∫ –±—ã–ª–æ
- **RAW body + HMAC** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
- **timingSafeEqual** - –∑–∞—â–∏—Ç–∞ –æ—Ç timing –∞—Ç–∞–∫
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

## üìã Checklist

- [x] @astrojs/node —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ package.json
- [x] output: 'hybrid' –¥–æ–±–∞–≤–ª–µ–Ω –≤ astro.config.mjs
- [x] adapter –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è dev —Ä–µ–∂–∏–º–∞
- [x] –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π GET-—Ö—ç–Ω–¥–ª–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ webhook.ts
- [x] POST-–ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [x] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç (200)
- [x] –í–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã
- [x] GET –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã (404 –±–µ–∑ DEBUG)
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

## üéâ –ò—Ç–æ–≥

apps/website —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–¥ –≤–µ–±—Ö—É–∫ Cal.com:
- ‚úÖ Server —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∫–ª—é—á–µ–Ω (output: 'hybrid')
- ‚úÖ @astrojs/node —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è production
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π GET-—Ö—ç–Ω–¥–ª–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ POST-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

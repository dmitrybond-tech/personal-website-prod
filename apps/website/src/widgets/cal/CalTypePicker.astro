---
// apps/website/src/widgets/cal/CalTypePicker.astro

interface Props {
  locale?: 'en' | 'ru';
  className?: string;
}

const { locale = 'en', className = '' } = Astro.props;

// Локализованные тексты
const texts = {
  en: {
    title: 'Choose meeting duration',
    duration15: '15 min',
    duration30: '30 min',
    duration60: '60 min',
  },
  ru: {
    title: 'Выберите продолжительность встречи',
    duration15: '15 мин',
    duration30: '30 мин',
    duration60: '60 мин',
  },
};

const t = texts[locale];

// Получаем ссылки на типы встреч из env
const event15 = import.meta.env.PUBLIC_CAL_EVENT_15;
const event30 = import.meta.env.PUBLIC_CAL_EVENT_30;
const event60 = import.meta.env.PUBLIC_CAL_EVENT_60;
---

<div class={`cal-type-picker ${className}`}>
  <h3 class="cal-type-picker-title">{t.title}</h3>
  <div class="cal-type-picker-buttons">
    <button 
      class="cal-type-btn" 
      data-duration="15" 
      data-cal-link={event15}
      disabled={!event15}
    >
      {t.duration15}
    </button>
    <button 
      class="cal-type-btn" 
      data-duration="30" 
      data-cal-link={event30}
      disabled={!event30}
    >
      {t.duration30}
    </button>
    <button 
      class="cal-type-btn" 
      data-duration="60" 
      data-cal-link={event60}
      disabled={!event60}
    >
      {t.duration60}
    </button>
  </div>
</div>

<style>
  .cal-type-picker {
    text-align: center;
    margin-bottom: 32px;
  }

  .cal-type-picker-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 16px 0;
    color: #1a1a1a;
  }

  .cal-type-picker-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .cal-type-btn {
    padding: 12px 24px;
    border: 2px solid #e3e3e3;
    background: white;
    border-radius: 8px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 80px;
  }

  .cal-type-btn:hover:not(:disabled) {
    border-color: #007bff;
    color: #007bff;
    background: #f8f9ff;
  }

  .cal-type-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .cal-type-btn.active {
    border-color: #007bff;
    background: #007bff;
    color: white;
  }

  /* Dark theme */
  :global(.dark) .cal-type-picker-title {
    color: #ffffff;
  }

  :global(.dark) .cal-type-btn {
    background: rgba(40, 40, 40, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
    color: #ccc;
  }

  :global(.dark) .cal-type-btn:hover:not(:disabled) {
    border-color: #007bff;
    color: #007bff;
    background: rgba(0, 123, 255, 0.1);
  }

  :global(.dark) .cal-type-btn.active {
    border-color: #007bff;
    background: #007bff;
    color: white;
  }

  @media (max-width: 768px) {
    .cal-type-picker-buttons {
      flex-direction: column;
      align-items: center;
    }

    .cal-type-btn {
      width: 100%;
      max-width: 200px;
    }
  }
</style>

<script>
  // Обработка кликов по кнопкам типов встреч
  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.cal-type-btn');
    const calEmbed = document.getElementById('cal-embed');

    buttons.forEach(button => {
      button.addEventListener('click', function() {
        const calLink = this.dataset.calLink;
        
        if (!calLink) {
          console.warn('Cal link not configured for duration:', this.dataset.duration);
          return;
        }

        // Убираем активный класс со всех кнопок
        buttons.forEach(btn => btn.classList.remove('active'));
        
        // Добавляем активный класс к текущей кнопке
        this.classList.add('active');

        // Обновляем data-атрибут контейнера
        if (calEmbed) {
          calEmbed.dataset.calLink = calLink;
        }

        // Переключаем Cal.com embed
        if (window.Cal) {
          try {
            window.Cal('ui', { calLink });
            console.log('Cal.com embed switched to:', calLink);
          } catch (error) {
            console.error('Failed to switch Cal.com embed:', error);
          }
        } else {
          console.warn('Cal.com not loaded yet');
        }
      });
    });
  });
</script>

---
import LanguageToggle from '@shared/ui/LanguageToggle/LanguageToggle.astro';
import { getLocaleFromPath, swapLocale } from '@shared/config/i18n';

interface Props {
  locale: 'en' | 'ru';
}

type Locale = 'en' | 'ru';

// Получаем локаль из пропсов
const { locale } = Astro.props;

// Локализованные лейблы (явно заданы для UTF-8)
const L = {
  en: { about: 'About', book: 'Book Me', brand: 'Dmitry B.' },
  ru: { about: 'Обо мне', book: 'Записаться', brand: 'Дмитрий Б.' },
}[locale];
---

<style>
  .nav-island {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 8px;
    min-height: 60px; /* Стабильная высота для предотвращения прыжков */

    background: var(--nav-bg);
    backdrop-filter: blur(8px);
    border: 1px solid var(--nav-border);
    border-radius: 16px;         /* скругление */
    box-shadow: 0 6px 20px rgba(0,0,0,.06); /* лёгкая тень */
    padding: 10px 14px;
  }

  /* Адаптивность для узких экранов */
  @media (max-width: 640px) {
    .nav-island {
      grid-template-columns: auto 1fr auto;
      gap: 4px;
      padding: 8px 12px;
    }
    
    .center-nav {
      justify-self: center;
      gap: 4px;
      padding: 2px;
    }
    
    .nav-btn {
      padding: 4px 8px;
      font-size: 0.875rem;
    }
    
    .right {
      justify-self: end;
    }
    
    .right .flex {
      gap: 4px;
    }
  }
  .brand { 
    justify-self: start; 
    font-weight: 600; 
    opacity:.85; 
    text-decoration: none;
    color: var(--nav-fg, #001111);
    transition: opacity .2s ease;
  }
  .brand:hover {
    opacity: 1;
  }
  .center-nav {
    justify-self: center;
    display: inline-flex; gap: 8px;
    border: 1px solid var(--nav-panel-border);
    background: var(--nav-panel-bg);
    border-radius: 999px; padding: 4px;
  }
  .nav-btn { 
    padding: 6px 14px; 
    border-radius: 999px; 
    text-decoration:none; 
    color: var(--nav-fg); 
    background: var(--nav-chip-bg);
    transition: background .2s ease;
  }
  .nav-btn:hover { 
    background: var(--nav-chip-active-bg); 
  }
  .right { 
    justify-self: end; 
  }
  .nav-island a { 
    text-decoration: none; 
    color: inherit; 
  }
</style>

<header class="nav-surface" data-app-navbar>
  <div class="nav-island mx-auto w-full max-w-[var(--cv-max-w)] px-[var(--cv-gap)]">
    <div class="brand nav-item">
      <a href={`/${locale}/about`}>{L.brand}</a>
    </div>
    <nav class="center-nav">
      <a class="nav-btn nav-item nav-chip" href={`/${locale}/about`} aria-current={Astro.url.pathname.includes('/about') ? 'page' : 'false'}>{L.about}</a>
      <a class="nav-btn nav-item nav-chip" href={`/${locale}/bookme`} aria-current={Astro.url.pathname.includes('/bookme') ? 'page' : 'false'}>{L.book}</a>
    </nav>
    <div class="right">
      <LanguageToggle locale={locale} />
    </div>
  </div>
</header>

<script>
  const el = document.querySelector('header[data-app-navbar]');
  const set = () => {
    const h = el?.offsetHeight || 72;
    document.documentElement.style.setProperty('--navbar-h', h + 'px');
  };
  set();
  new ResizeObserver(set).observe(el);
</script>

---
import { readFooter } from '../../content/lib/cmsLoader';
import { mapFooterData } from '../../content/lib/mapFooter';
import { getLocaleFromPath } from '../../shared/i18n/locales';

const pathname = Astro.url?.pathname || "/";
const locale = getLocaleFromPath(pathname);

// Load footer data from CMS with fallback to defaults
const cmsFooterData = await readFooter(locale);
const footerData = mapFooterData(cmsFooterData, locale);
---
<footer
  class="mt-12 border-t border-black/10 dark:border-white/10 bg-white/70 dark:bg-[#0b0c10]/70 backdrop-blur supports-[backdrop-filter]:bg-white/60 supports-[backdrop-filter]:dark:bg-[#0b0c10]/60"
>
  <div class="cv-root mx-auto w-full max-w-[var(--bookme-max-w,960px)] px-4 py-8 md:py-10">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
      <div class="min-w-0">
        <p class="text-sm leading-relaxed text-gray-800 dark:text-gray-100">
          {footerData.brandLine}
        </p>
        {footerData.consent && (
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
            {footerData.consent.bannerText}
          </p>
        )}
      </div>

      <nav class="flex flex-wrap items-center gap-x-6 gap-y-3 text-sm">
        {footerData.links.map((link) => (
          <a
            href={link.href}
            class="ui-outline rounded px-2 py-1 text-gray-800 dark:text-gray-100 hover:opacity-90 focus-visible:outline-2"
            target={link.external ? "_blank" : undefined}
            rel={link.external ? "noopener noreferrer" : undefined}
          >
            {link.label}
          </a>
        ))}
      </nav>
    </div>
  </div>
</footer>

<style>
  /* Fallback if ui-outline isn't global */
  .ui-outline { outline: 1px solid color-mix(in oklch, currentColor 22%, transparent); }
</style>

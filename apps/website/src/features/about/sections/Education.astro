---
import SectionCard from '../../../components/sections/SectionCard.astro';
import EducationIsland from '../../../components/about/EducationIsland.tsx';

export interface Props {
  section: any;
  lang: 'en' | 'ru';
}

const { section, lang } = Astro.props;

// Helper function for i18n
const t = (obj: any, lang: 'en' | 'ru') => (typeof obj === 'object' && obj ? obj[lang] ?? obj.en ?? '' : obj ?? '');

// Process the education data
const educationData = section.data || {};
const title = t(educationData.title, lang) || 'Education';

// Normalize data - support both new institution structure and legacy flat items
let institutions = [];
if (Array.isArray(educationData.items)) {
  // New structure: institutions with degrees
  institutions = educationData.items;
} else if (Array.isArray(educationData.legacyItems)) {
  // Legacy structure: flat items, normalize to institution structure
  institutions = educationData.legacyItems.map((item: any) => ({
    school: item.institution,
    location: item.location,
    url: item.url,
    logo: item.image,
    degrees: [{
      degree: item.degree,
      program: item.field,
      period: item.dates ? `${item.dates[0]} â€“ ${item.dates[1] || 'Present'}` : undefined,
      bullets: item.achievements
    }]
  }));
}

---

<SectionCard 
  title={title}
  hasHeaderMedia={false}
>
  <EducationIsland institutions={institutions} />
</SectionCard>
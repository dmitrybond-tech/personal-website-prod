---
import type { Data } from '../types/data';
import SideNav from './SideNav.astro';
import MainSection from './sections/MainSection.astro';
import SkillsSection from './sections/SkillsSection.astro';
import ExperienceSection from './sections/ExperienceSection.astro';
import PortfolioSection from './sections/PortfolioSection.astro';
import EducationSection from './sections/EducationSection.astro';
import TestimonialsSection from './sections/TestimonialsSection.astro';
import FavoritesSection from './sections/FavoritesSection.astro';

export interface Props {
  locale: 'en' | 'ru';
  data: Data;
}

const { locale, data } = Astro.props;
const { config, sections } = data;
---

<section class="cv-root">
  <div class="cv-layout mx-auto max-w-[var(--cv-max-w)] px-[var(--cv-gap)]
              grid grid-cols-1 xl:grid-cols-[1fr_auto] gap-8
              overflow-visible">
    <main class="min-w-0 isolate">
      <div class="cv-sections flex flex-col gap-8 xl:gap-10 pt-1">
        <MainSection {...sections.main} client:visible />
        <SkillsSection {...sections.skills} client:visible />
        <ExperienceSection {...sections.experience} client:visible />
        <PortfolioSection {...sections.portfolio} client:visible />
        <EducationSection {...sections.education} client:visible />
        <TestimonialsSection {...sections.testimonials} client:visible />
        <FavoritesSection {...sections.favorites} client:visible />
      </div>
    </main>
    <aside class="hidden xl:block overflow-visible">
      <div id="sidebar"
           class="sticky top-[calc(var(--navbar-h)+16px)] self-start h-min w-[64px]">
        <SideNav sections={sections} />
      </div>
    </aside>
  </div>
</section>

<style>
  @reference "../../../../styles/tailwind.css";
  
  .cv-root {
    @apply flex justify-center;
    /* Background now handled at body level for About pages */
    overflow: visible !important;
  }
  
  @media (min-width: 1280px) {
    .cv-root {
      @apply relative left-7;
    }
  }
  
  .cv-layout {
    overflow: visible !important;
  }
  
  .cv-main {
    @apply w-full max-w-5xl space-y-4 px-2 py-3;
  }
  
  @media (min-width: 640px) {
    .cv-main {
      @apply space-y-6 px-8 py-12;
    }
  }
  
  @media (min-width: 1024px) {
    .cv-main {
      @apply space-y-8 py-20;
    }
  }
  
  /* Ensure proper spacing for sticky navbar */
  .cv-main > * {
    scroll-margin-top: var(--navbar-h);
  }
</style>

<script is:inline>
  function setActiveItem() {
    try {
      var path = (window && window.location && window.location.pathname) || '';
      var hash = (window && window.location && window.location.hash) || '';
      var links = document.querySelectorAll('[data-sidenav-link]');
      links.forEach(function (a) {
        var href = a && a.getAttribute ? (a.getAttribute('href') || '') : '';
        if (!href) {
          a && a.setAttribute && a.setAttribute('aria-current', 'false');
          return;
        }
        var active =
          (path && href && path.endsWith(href)) ||
          (hash && href && hash === href);
        a.classList.toggle('active', !!active);
        a.setAttribute('aria-current', active ? 'page' : 'false');
      });
    } catch (e) { /* no-op */ }
  }

  document.addEventListener('DOMContentLoaded', setActiveItem);
  window.addEventListener('hashchange', setActiveItem);
</script>

<!-- Navbar height sync removed - handled globally in AppShell.astro -->
